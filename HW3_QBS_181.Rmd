---
title: "HW3_QBS_181"
author: "Deepanshi"
date: "11/7/2018"
output: pdf_document
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)

```



Ans 1
```{r}
library(dplyr)
library(tidyverse)
library(magrittr)
```

For table2
```{r}
table2
a <- spread(table2,key=type,value=count)
# Extract the number of TB cases per country per year
m <-  select(a,country, year, cases)
m
#Extract the matching population per country per year
n <- select(a,country, year, population)
n
#Divide cases by population, and multiply by 10,000
rate <- m%>%mutate(population= n$population, casesperpop = (cases / population) * 10000)
o <- select (rate, country, year, casesperpop)
o
#Storing it in appropriate place
store <- o%>%mutate(cases= m$cases, population= n$population)
final_store <- gather(store, type, count, casesperpop, cases, population)
final_store

```

for table4a+table4b
```{r}
table4a
table4b

# Extract the number of TB cases per country per year
m1 <- table4a%>%gather(key="year",value="cases", `1999`,`2000`)
m1
#Extract the matching population per country per year
n1 <- table4b%>%gather(key="year",value="population", `1999`,`2000`)
n1
#Divide cases by population, and multiply by 10,000
rate1 <- m1%>%mutate(population= n1$population, casesperpop1 = (cases / population) * 10000)
rate1
o1 <- select (rate1, country, year, casesperpop1)
o1
#Storing it in appropriate place
store1 <- o1%>%mutate(cases= m1$cases, population= n1$population)
final_store1 <- gather(store1, type, count, casesperpop1, cases, population)

```


Ans2
The following code was throwing an error "Error in inds_combine(.vars, ind_list) : Position must be between 0 and n"
```{r}
##table4a%>%gather(1999,2000,key="year",value="cases")
```
The following code worked
```{r}
table4a%>%gather(key="year",value="cases", `1999`,`2000`)

```


Ans 3
```{r}
library(nycflights13)
library(ggplot2)
library(dplyr)
library(magrittr)
library(tidyverse)
library(lubridate)

```

Here we are making a common function to pass it later in dep_time, arr_time, sched_dep_time, sched_arr_time to convert in hours and minutes(example 517 would convert to 5:17)

"%/%" this would leave integer division and "%%" this would give the remainder
```{r}
datetime_df <- function(year, month, day, time) {
  make_datetime(year, month, day, time %/% 100, time %% 100)
}

flights_df <- flights %>%
  filter(!is.na(dep_time), !is.na(arr_time)) %>%
  mutate(
    dep_time = datetime_df(year, month, day, dep_time),
    arr_time = datetime_df(year, month, day, arr_time),
    sched_dep_time = datetime_df(year, month, day, sched_dep_time),
    sched_arr_time = datetime_df(year, month, day, sched_arr_time)
  ) %>%
  
select(flight, origin, dest, dep_time, sched_dep_time, dep_delay, arr_time, sched_arr_time, arr_delay, air_time)

flights_df
```


3a) How does the distribution of flights times within a day change over the course of the year

```{r}
flights_df %>%
  mutate(time_of_flight = hour(arr_time) * 100 + minute(arr_time),
         m_df = as.factor(month
                          (arr_time))) %>%
  ggplot(aes(x = time_of_flight, group = m_df, color = m_df)) +
  geom_freqpoly(binwidth = 200)
```

we can show the same thing with dep_time, sched_arr_time, sched_dep_time
```{r}
flights_df %>%
  mutate(time_of_flight = hour(dep_time) * 100 + minute(dep_time),
         m_df = as.factor(month
                          (dep_time))) %>%
  ggplot(aes(x = time_of_flight, group = m_df, color = m_df)) +
  geom_freqpoly(binwidth = 200)


flights_df %>%
  mutate(time_of_flight = hour(sched_arr_time) * 100 + minute(sched_arr_time),
         m_df = as.factor(month
                          (sched_arr_time))) %>%
  ggplot(aes(x = time_of_flight, group = m_df, color = m_df)) +
  geom_freqpoly(binwidth = 200)

flights_df %>%
  mutate(time_of_flight = hour(sched_dep_time) * 100 + minute(sched_dep_time),
         m_df = as.factor(month
                          (sched_dep_time))) %>%
  ggplot(aes(x = time_of_flight, group = m_df, color = m_df)) +
  geom_freqpoly(binwidth = 200)
```
It can be seen that it will make a more or less similar graph for all of the times

What we can see from the graph is that the month 2 i.e february is lower maybe because february has minimum day among other months where as month 10 i.e october curve is above all other month for the first half part of day and october has 31 days. For the later part of the day, month 3 i.e march can be seen above all other months and march also consists of 31 days


3b) Compare dep_time,sched_dep_time, and dep_delay. Are they consistent. Explain your findings
```{r}
k <- flights_df %>%
  mutate(calculated_delay = (dep_time - sched_dep_time) / 60 , diff = as.numeric(calculated_delay - dep_delay)) %>%
  select(dep_time, sched_dep_time, dep_delay, calculated_delay, diff)
k
```
We can see that row 152 shows difference n calculated delay and dep delay thus it means that there exists some discrepencies. The differnce or diff is -1440 which is way extreme and maybe we can conclude that this error have come due to the mistake while filling the data

we cannot say about rows so we'll just see the number of rows with and without filter for departure delays

It is showing 328,063 rows
```{r}
k_filter <- flights_df %>%
  mutate(calculated_delay = (dep_time - sched_dep_time) / 60 , diff = as.numeric(calculated_delay - dep_delay)) %>%
  filter(calculated_delay != dep_delay) %>%
  select(dep_time, sched_dep_time, dep_delay, calculated_delay, diff)
k_filter
```
I have also tried showing this on the graph

```{r}
flights_df %>%
  mutate(calculated_delay = (dep_time - sched_dep_time) / 60, diff = as.numeric(calculated_delay - dep_delay)) %>%
  ggplot(aes(diff)) +
  geom_bar() +
  coord_cartesian(xlim = c(-5000,5000))
```
There is more density on 0 which means that there is no difference between calculated_delay and dep_delay but we can also see  a bar on the left side of zero with very little density which means there are some observations with differences between the calculated_delay and dep_delay 


3c)
Confirm my hypothesis that the early departures of flights in minutes 20-30 and 50-60 are caused by scheduled flights that leave early. Hint: create a binary variable that tells you whether or not a flight was delayed.

```{r}
flights_df %>%
  mutate(early_departures = dep_delay < 0,
         #early_departures = dep_delay < 0 this will give departures in negative integers which will indicate the early departure flights
         time_in_minutes = minute(sched_dep_time)) %>%
         # we are converting sched_dep_time into minutes so that we can compare it for 20-30 mins and 50-60 mins
  group_by(time_in_minutes) %>%
  summarise(early_departures = mean(early_departures)) %>%
  ggplot(aes(x = time_in_minutes, y = early_departures)) +geom_line()

```  
We can see from the graph the line is dipping between 20-30 mins and 50-60 minutes. Hypothesis is thus proved.


Ans4 

```{r}
library(rvest)

#Reading webpage
scraping_geiselmed_qbs <-  read_html("https://geiselmed.dartmouth.edu/qbs/")

head(scraping_geiselmed_qbs)

h1_text <- scraping_geiselmed_qbs %>% html_nodes("h1") %>%html_text()
h1_text
h2_text <- scraping_geiselmed_qbs %>% html_nodes("h2") %>%html_text()
h2_text
h3_text <- scraping_geiselmed_qbs %>% html_nodes("h3") %>%html_text()
length(h3_text)
h3_text
h4_text <- scraping_geiselmed_qbs %>% html_nodes("h4") %>%html_text()

p_nodes <- scraping_geiselmed_qbs %>%html_nodes("p")
p_nodes[7:13]
p_text <- scraping_geiselmed_qbs %>% html_nodes("p") %>%html_text()
p_text
length(p_text)

#scraping paragraph 15
p_text[15]
ul_text <- scraping_geiselmed_qbs %>% html_nodes("ul") %>%html_text()
length(ul_text)

#scraping unordered list from the source webpage
ul_text[1]
ul_text[13]
ul_text[19]

#scraping particular text from unordered list 2
substr(ul_text[2],start=22,stop=44)

li_text <- scraping_geiselmed_qbs %>% html_nodes("li") %>%html_text()
length(li_text)
li_text[18:23]

all_text <- scraping_geiselmed_qbs %>%
  html_nodes("div") %>% 
  html_text()



#
results <- scraping_geiselmed_qbs %>% html_nodes(".short-desc")
results
#we can see that there is no data for the short description on the source webpage


```

